@using _02_Entidades;
@using _03_Data;
@{ BD_NucleosEjecutoresEntities context = new BD_NucleosEjecutoresEntities(); }


<div class="form-group">
    <button class="btn btn-success" onclick="ExportarExcel('tblMatrizReportesPlanosActividadesJASS', 'rpt_MatrizResumenActividadesJASS_')"><i class="fa fa-file-excel-o"></i>Exportar</button>
</div>

<div class="form-group" id="divMatrizReportesPlanosActividadesJASS" style="overflow:auto">
    <table class="table table-bordered-black table-hover" id="tblMatrizReportesPlanosActividadesJASS">
            <tr>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" rowspan="2">N°</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" rowspan="2">CUI</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" rowspan="2">Región</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" rowspan="2">Localidad</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" colspan="2">Cantidad de <br />Capacitaciones</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;" colspan="3">Cantidad de <br />Participantes</td>
            </tr>
            <tr>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;">Programadas</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;">Ejecutadas</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;">Hombres</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;">Mujeres</td>
                <td style="font-weight: bold; text-align: center; vertical-align: middle !important;background-color:rgb(0,112,192);color:#fff;font-size: 16px;border: 0.5px solid #333;">Total</td>
            </tr>
            @{
                var objActividades = context.CronogramaActividades.Where(x => x.Tipo == "JASS" && x.Activo == true).ToList();
                var objproy = context.Proyecto.Where(x => x.Cod_subprograma == 133 && x.Estado == 1).ToList();

                if (objproy != null && objproy.Count() > 0)
                {
                    var Count = 1;
                    foreach (var item in objproy)
                    {
                        var depa = context.Departamento.SingleOrDefault(x => x.cod_depa == item.IdUbigeo.Substring(0, 2));
                        var objDet = context.DetalleSeguimientoActividadesJASS.Where(x => x.SeguimientoActividadesJASS.CUI == item.CUI && x.Fecha != null && x.Activo == true).ToList();
                                <tr>
                                    <td style="width:30px;vertical-align: middle;text-align: center;">@(Count++)</td>
                                    <td style="width:30px;vertical-align: middle;text-align: center;">@item.CUI</td>
                                    <td style="word-wrap: break-word;white-space: normal;width:150px;vertical-align: middle;">@depa.nom_depa </td>
                                    <td style="word-wrap: break-word;white-space: normal;width:150px;vertical-align: middle;">@item.Localidad </td>
                                    <td style="word-wrap: break-word;white-space: normal;width:150px;vertical-align: middle;text-align: center;">@objActividades.Count() </td>
                                    <td style="word-wrap: break-word;white-space: normal;width:150px;vertical-align: middle;text-align: center;">@objDet.Count() </td>
                                    <td style="word-wrap: break-word;white-space: normal;width:300px;vertical-align: middle;text-align:center">@objDet.Sum(x => x.NroHombres)</td>
                                    <td style="word-wrap: break-word;white-space: normal;width:300px;vertical-align: middle;text-align:center">@objDet.Sum(x => x.NroMujeres)</td>
                                    <td style="word-wrap: break-word;white-space: normal;width:300px;vertical-align: middle;text-align:center">@objDet.Sum(x => x.Total)</td>
                                </tr>
                    }
                }
            }

    </table>
</div>
